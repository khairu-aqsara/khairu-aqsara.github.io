{{- /* SEO Enhancement Partial */ -}}

{{- /* Enhanced Meta Tags */ -}}
{{- if .Description }}
<meta name="description" content="{{ .Description }}">
{{- else }}
<meta name="description" content="{{ site.Params.description }}">
{{- end }}

{{- /* Keywords from tags and site params */ -}}
{{- $keywords := slice }}
{{- if .Params.tags }}
  {{- $keywords = .Params.tags }}
{{- end }}
{{- if site.Params.keywords }}
  {{- $keywords = $keywords | append site.Params.keywords }}
{{- end }}
{{- with $keywords }}
<meta name="keywords" content="{{ delimit . ", " }}">
{{- end }}

{{- /* Enhanced Open Graph */ -}}
<meta property="og:title" content="{{ .Title | default site.Title }}">
<meta property="og:description" content="{{ .Description | default site.Params.description }}">
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:site_name" content="{{ site.Title }}">
<meta property="og:locale" content="{{ site.Language.Lang | default "en_US" }}">

{{- /* Article specific Open Graph */ -}}
{{- if .IsPage }}
<meta property="article:author" content="{{ .Params.author | default site.Params.author }}">
<meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
<meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
{{- with .Params.tags }}
{{- range . }}
<meta property="article:tag" content="{{ . }}">
{{- end }}
{{- end }}
{{- end }}

{{- /* Twitter Cards */ -}}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ .Title | default site.Title }}">
<meta name="twitter:description" content="{{ .Description | default site.Params.description }}">

{{- /* Image handling for social sharing */ -}}
{{- $image := "" }}
{{- if .Params.image }}
  {{- $image = .Params.image }}
{{- else if .Params.cover.image }}
  {{- $image = .Params.cover.image }}
{{- else if site.Params.defaultImage }}
  {{- $image = site.Params.defaultImage }}
{{- end }}

{{- if $image }}
  {{- if hasPrefix $image "http" }}
<meta property="og:image" content="{{ $image }}">
<meta name="twitter:image" content="{{ $image }}">
  {{- else }}
<meta property="og:image" content="{{ $image | absURL }}">
<meta name="twitter:image" content="{{ $image | absURL }}">
  {{- end }}
{{- end }}

{{- /* Enhanced Structured Data */ -}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  {{- if .IsPage }}
  "@type": "BlogPosting",
  "headline": "{{ .Title }}",
  "name": "{{ .Title }}",
  "description": "{{ .Description | default .Summary }}",
  "author": {
    "@type": "Person",
    "name": "{{ .Params.author | default site.Params.author }}"
  },
  "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
  "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
  "url": "{{ .Permalink }}",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ .Permalink }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ site.Title }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ "favicon.ico" | absURL }}"
    }
  },
  {{- if $image }}
  "image": "{{ if hasPrefix $image "http" }}{{ $image }}{{ else }}{{ $image | absURL }}{{ end }}",
  {{- end }}
  {{- with .Params.tags }}
  "keywords": [{{ range $i, $tag := . }}{{ if $i }},{{ end }}"{{ $tag }}"{{ end }}],
  {{- end }}
  "wordCount": "{{ .WordCount }}",
  "genre": ["{{ range .Params.categories }}{{ . }}{{ end }}"],
  "articleBody": {{ .Content | plainify | jsonify }}
  {{- else }}
  "@type": "WebSite",
  "name": "{{ site.Title }}",
  "url": "{{ site.BaseURL }}",
  "description": "{{ site.Params.description }}",
  "publisher": {
    "@type": "Organization",
    "name": "{{ site.Title }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ "favicon.ico" | absURL }}"
    }
  },
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{{ "search" | absURL }}?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
  {{- end }}
}
</script>

{{- /* Breadcrumb Structured Data */ -}}
{{- if .IsPage }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ site.BaseURL }}"
    },
    {{- if .Section }}
    {
      "@type": "ListItem", 
      "position": 2,
      "name": "{{ .Section | title }}",
      "item": "{{ .Section | absURL }}"
    },
    {{- end }}
    {
      "@type": "ListItem",
      "position": {{ if .Section }}3{{ else }}2{{ end }},
      "name": "{{ .Title }}",
      "item": "{{ .Permalink }}"
    }
  ]
}
</script>
{{- end }}