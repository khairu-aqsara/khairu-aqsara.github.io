{{- /* Performance Optimization Partial */ -}}

{{- /* Resource Hints for improved loading */ -}}
{{- /* DNS Prefetch for external domains */ -}}
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net">

{{- /* Preload critical resources */ -}}
{{- if .IsHome }}
<link rel="preload" as="image" href="{{ "images/sample-hero-image.jpg" | absURL }}" media="(min-width: 768px)">
{{- end }}

{{- /* Preload search index on search page */ -}}
{{- if eq .Layout "search" }}
<link rel="preload" as="fetch" href="{{ "index.json" | absURL }}" crossorigin="anonymous">
{{- end }}

{{- /* Web App Manifest */ -}}
<link rel="manifest" href="{{ "manifest.json" | absURL }}">

{{- /* Critical CSS inlining for above-the-fold content */ -}}
{{- if .IsHome }}
<style>
/* Critical CSS for homepage above-the-fold content */
.main { display: block; }
.profile { display: flex; align-items: center; margin: 2rem 0; }
.profile img { width: 120px; height: 120px; border-radius: 50%; margin-right: 2rem; }
.home-info { text-align: center; margin: 2rem 0; }
.home-info h1 { font-size: 2.5rem; margin-bottom: 1rem; }
.home-info p { font-size: 1.2rem; color: var(--secondary); }
</style>
{{- end }}

{{- /* Font Loading Optimization */ -}}
{{- if site.Params.customFonts }}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" media="print" onload="this.media='all'">
<noscript>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
</noscript>
{{- end }}

{{- /* Service Worker Registration for Caching */ -}}
{{- if hugo.IsProduction }}
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js')
      .then(function(registration) {
        console.log('ServiceWorker registration successful');
      })
      .catch(function(err) {
        console.log('ServiceWorker registration failed: ', err);
      });
  });
}
</script>
{{- end }}

{{- /* Lazy Loading Enhancement */ -}}
<script>
// Enhanced lazy loading for images
document.addEventListener('DOMContentLoaded', function() {
  // Add loading="lazy" to images that don't have it
  const images = document.querySelectorAll('img:not([loading])');
  images.forEach(img => {
    img.setAttribute('loading', 'lazy');
  });
  
  // Intersection Observer for progressive image loading
  if ('IntersectionObserver' in window) {
    const imageObserver = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target;
          if (img.dataset.src) {
            img.src = img.dataset.src;
            img.removeAttribute('data-src');
            observer.unobserve(img);
          }
        }
      });
    });
    
    document.querySelectorAll('img[data-src]').forEach(img => {
      imageObserver.observe(img);
    });
  }
});
</script>

{{- /* Prefetch next/previous pages for better navigation */ -}}
{{- if .IsPage }}
  {{- with .NextInSection }}
  <link rel="prefetch" href="{{ .Permalink }}">
  {{- end }}
  {{- with .PrevInSection }}
  <link rel="prefetch" href="{{ .Permalink }}">
  {{- end }}
{{- end }}

{{- /* Resource hints for common navigation */ -}}
{{- if .IsHome }}
<link rel="prefetch" href="{{ "posts" | absURL }}">
<link rel="prefetch" href="{{ "search" | absURL }}">
{{- end }}