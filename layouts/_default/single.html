{{- define "main" }}

<article class="post-single">
  {{- $isHidden := (.Params.cover.hidden | default site.Params.cover.hiddenInSingle | default site.Params.cover.hidden) }}
  {{- if (and .Params.cover.image (not $isHidden)) }}
  <figure class="entry-cover">
    {{- $alt := (.Params.cover.alt | default .Title | default "cover") }}
    {{- $caption := .Params.cover.caption | default "" }}
    {{- $coverImage := "" }}
    {{- if .Params.cover.relative }}
      {{- $coverImage = .Resources.GetMatch (printf "*%s*" .Params.cover.image) }}
    {{- else }}
      {{- $coverImage = resources.Get .Params.cover.image }}
    {{- end }}
    {{- if $coverImage }}
      <img loading="lazy" src="{{ $coverImage.RelPermalink }}" alt="{{ $alt }}" 
           {{- if $caption }} title="{{ $caption }}"{{ end }}>
    {{- else }}
      <img loading="lazy" src="{{ .Params.cover.image }}" alt="{{ $alt }}"
           {{- if $caption }} title="{{ $caption }}"{{ end }}>
    {{- end }}
    {{- if $caption }}
    <figcaption>{{ $caption | markdownify }}</figcaption>
    {{- end }}
  </figure>
  {{- end }}

  <header class="entry-header">
    {{- if (.Param "ShowBreadCrumbs") }}
    <nav class="breadcrumbs">
      <a href="{{ "/" | relLangURL }}">{{ i18n "home" | default "Home" }}</a>
      <span class="breadcrumb-separator">&nbsp;›&nbsp;</span>
      <a href="{{ "/posts" | relLangURL }}">{{ i18n "posts" | default "Posts" }}</a>
      <span class="breadcrumb-separator">&nbsp;›&nbsp;</span>
      <span class="breadcrumb-current">{{ .Title }}</span>
    </nav>
    {{- end }}
    
    <h1 class="entry-title">{{ .Title }}</h1>
    
    {{- if .Params.description }}
    <div class="entry-description">
      {{ .Params.description | markdownify }}
    </div>
    {{- end }}
    
    {{- if not (.Param "hideMeta") }}
    <div class="entry-meta">
      <div class="entry-meta-row">
        {{- if not (.Param "hideAuthor") }}
        <span class="entry-author">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          {{ .Params.author | default site.Params.author }}
        </span>
        {{- end }}
        
        <span class="entry-date">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
            {{ .Date.Format "January 2, 2006" }}
          </time>
          {{- if (.Param "ShowReadingTime") }}
          <span class="separator">&middot;</span>
          <span class="reading-time">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12,6 12,12 16,14"></polyline>
            </svg>
            {{ .ReadingTime }} {{ i18n "read_time" | default "min read" }}
          </span>
          {{- end }}
          {{- if (.Param "ShowWordCount") }}
          <span class="separator">&middot;</span>
          <span class="word-count">{{ .WordCount }} {{ i18n "words" | default "words" }}</span>
          {{- end }}
        </span>
      </div>
      
      {{- if (and (.Params.lastmod) (ne .Params.lastmod .Date)) }}
      <div class="entry-meta-row">
        <span class="entry-lastmod">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 6H3"></path>
            <path d="M10 12H3"></path>
            <path d="M10 18H3"></path>
            <circle cx="17" cy="15" r="3"></circle>
            <path d="m21 19-1.5-1.5"></path>
          </svg>
          {{ i18n "updated" | default "Updated" }}: 
          <time datetime="{{ .Params.lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
            {{ .Params.lastmod.Format "January 2, 2006" }}
          </time>
        </span>
      </div>
      {{- end }}
      
      {{- if .Params.tags }}
      <div class="entry-tags">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19"></path>
          <path d="M9.586 5.586A2 2 0 0 0 8.172 5H3a2 2 0 0 0-2 2v5.172a2 2 0 0 0 .586 1.414L8 20l5-5"></path>
          <circle cx="6.5" cy="9.5" r=".5" fill="currentColor"></circle>
        </svg>
        {{- range $index, $tag := .Params.tags }}
        {{- if gt $index 0 }}, {{ end }}
        <a href="{{ "/tags/" | relLangURL }}{{ $tag | urlize }}/" class="tag">{{ $tag }}</a>
        {{- end }}
      </div>
      {{- end }}
      
      {{- if .Params.categories }}
      <div class="entry-categories">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m7.5 4.27 9 5.15"></path>
          <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"></path>
          <path d="m3.3 7 8.7 5 8.7-5"></path>
          <path d="M12 22V12"></path>
        </svg>
        {{- range $index, $category := .Params.categories }}
        {{- if gt $index 0 }}, {{ end }}
        <a href="{{ "/categories/" | relLangURL }}{{ $category | urlize }}/" class="category">{{ $category }}</a>
        {{- end }}
      </div>
      {{- end }}
    </div>
    {{- end }}
  </header>

  {{- $tocEnabled := ((.Param "ShowToc") | default false) }}
  {{- if (and $tocEnabled .TableOfContents) }}
  <div class="toc-container">
    <details class="toc" {{ if (.Param "TocOpen") }}open{{ end }}>
      <summary class="toc-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="8" y1="6" x2="21" y2="6"></line>
          <line x1="8" y1="12" x2="21" y2="12"></line>
          <line x1="8" y1="18" x2="21" y2="18"></line>
          <line x1="3" y1="6" x2="3.01" y2="6"></line>
          <line x1="3" y1="12" x2="3.01" y2="12"></line>
          <line x1="3" y1="18" x2="3.01" y2="18"></line>
        </svg>
        {{ i18n "toc" | default "Table of Contents" }}
      </summary>
      <div class="toc-content">
        {{- if (.Param "UseHugoToc") }}
          {{ .TableOfContents }}
        {{- else }}
          {{- partial "toc.html" . }}
        {{- end }}
      </div>
    </details>
  </div>
  {{- end }}

  <div class="post-content">{{ .Content }}</div>

  <footer class="entry-footer">
    {{- if .Params.keywords }}
    <div class="entry-keywords">
      <strong>{{ i18n "keywords" | default "Keywords" }}:</strong>
      {{- range $index, $keyword := .Params.keywords }}
      {{- if gt $index 0 }}, {{ end }}
      <span class="keyword">{{ $keyword }}</span>
      {{- end }}
    </div>
    {{- end }}
    
    {{- if (.Param "ShowPostNavLinks") }}
    <nav class="post-nav">
      {{- with .PrevInSection }}
      <a class="prev" href="{{ .RelPermalink }}" rel="prev">
        <span class="post-nav-label">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m15 18-6-6 6-6"></path>
          </svg>
          {{ i18n "prev_post" | default "Previous" }}
        </span>
        <span class="post-nav-title">{{ .Title }}</span>
      </a>
      {{- end }}
      
      {{- with .NextInSection }}
      <a class="next" href="{{ .RelPermalink }}" rel="next">
        <span class="post-nav-label">
          {{ i18n "next_post" | default "Next" }}
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m9 18 6-6-6-6"></path>
          </svg>
        </span>
        <span class="post-nav-title">{{ .Title }}</span>
      </a>
      {{- end }}
    </nav>
    {{- end }}
    
    {{- if .Params.editPost.URL }}
    <div class="edit-post">
      <a href="{{ .Params.editPost.URL }}{{ if .Params.editPost.appendFilePath }}/{{ .File.Path }}{{ end }}" 
         target="_blank" rel="noopener noreferrer" class="edit-link">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path>
          <path d="m15 5 4 4"></path>
        </svg>
        {{ .Params.editPost.Text | default "Edit this page" }}
      </a>
    </div>
    {{- end }}
  </footer>
</article>

{{- if (.Param "ShowShareButtons") }}
<div class="share-buttons">
  <h3>{{ i18n "share" | default "Share this post" }}</h3>
  <div class="share-buttons-grid">
    <a href="https://twitter.com/intent/tweet?text={{ .Title }}&url={{ .Permalink }}" 
       target="_blank" rel="noopener noreferrer" class="share-button twitter">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path>
      </svg>
      Twitter
    </a>
    
    <a href="https://www.facebook.com/sharer/sharer.php?u={{ .Permalink }}" 
       target="_blank" rel="noopener noreferrer" class="share-button facebook">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
      </svg>
      Facebook
    </a>
    
    <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ .Permalink }}" 
       target="_blank" rel="noopener noreferrer" class="share-button linkedin">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
        <rect x="2" y="9" width="4" height="12"></rect>
        <circle cx="4" cy="4" r="2"></circle>
      </svg>
      LinkedIn
    </a>
    
    <button class="share-button copy-link" onclick="copyToClipboard('{{ .Permalink }}')">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
      </svg>
      Copy Link
    </button>
  </div>
</div>
{{- end }}

<script>
function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(function() {
    const button = event.target.closest('.copy-link');
    const originalText = button.innerHTML;
    button.innerHTML = button.innerHTML.replace('Copy Link', 'Copied!');
    setTimeout(() => {
      button.innerHTML = originalText;
    }, 2000);
  }).catch(function(err) {
    console.error('Could not copy text: ', err);
  });
}
</script>

{{- end }}